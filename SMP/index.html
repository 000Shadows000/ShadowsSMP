<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ranking Shadows SMP</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <div class="header-logos">
      <img src="logo.png" alt="Shadows SMP" class="logo">
      <img src="ranking.png" alt="Ranking" class="ranking">
    </div>
  </header>

  <main>
    <section>
      <table id="rankingTable">
        <thead>
          <tr>
            <th>Skin</th>
            <th>Jugador</th>
            <th>Construcción</th>
            <th>Técnico</th>
            <th>PvP</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          <!-- Se llena automáticamente -->
        </tbody>
      </table>
    </section>
  </main>

  <footer>
    <p>© 2025 Shadows SMP</p>
  </footer>

  <!-- 🌀 MODAL DE ESTADÍSTICAS -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 id="playerName"></h2>
      <img id="playerBody" class="player-body" src="" alt="Cuerpo del jugador">
      <canvas id="statsChart" width="300" height="300"></canvas>
      <div id="statsValues" class="stats-values"></div>
    </div>
  </div>

  <script>
    let chartInstance = null;

    async function cargarJugadores() {
      const response = await fetch("jugadores.json");
      const jugadores = await response.json();

      const tbody = document.querySelector("#rankingTable tbody");
      tbody.innerHTML = "";

      jugadores.forEach(j => {
        const fila = document.createElement("tr");

        const skin = `https://mc-heads.net/avatar/${encodeURIComponent(j.nombre)}`;
        const cuerpo = `https://mc-heads.net/body/${encodeURIComponent(j.nombre)}`;

        fila.innerHTML = `
          <td><img src="${skin}" alt="${j.nombre}" class="skin"></td>
          <td class="jugador-nombre">${j.nombre}</td>
          <td>${j.construccion}</td>
          <td>${j.tecnico}</td>
          <td>${j.pvp}</td>
          <td>${j.total}</td>
        `;

        fila.addEventListener("click", () => abrirModal(j, cuerpo));
        tbody.appendChild(fila);
      });

      ordenarTabla();
    }

    function ordenarTabla() {
      const table = document.getElementById("rankingTable").tBodies[0];
      const rows = Array.from(table.rows);

      rows.sort((a, b) => {
        const A = parseInt(a.cells[5].innerText);
        const B = parseInt(b.cells[5].innerText);
        return B - A;
      });

      rows.forEach((r, i) => {
        if (i === 0) r.classList.add("top1");
        else if (i === 1) r.classList.add("top2");
        else if (i === 2) r.classList.add("top3");
        table.appendChild(r);
      });
    }

    function abrirModal(jugador, cuerpoURL) {
      const modal = document.getElementById("modal");
      const nameEl = document.getElementById("playerName");
      const bodyEl = document.getElementById("playerBody");
      const statsValues = document.getElementById("statsValues");

      nameEl.textContent = jugador.nombre;
      bodyEl.src = cuerpoURL;

      const stats = [
        jugador.potencial || jugador.construccion,
        jugador.precision || jugador.tecnico,
        jugador.adaptabilidad || jugador.total / 2,
        jugador.pvp,
        jugador.construccion,
        jugador.tecnico
      ];

      const labels = ["Potencial", "Precisión", "Adaptabilidad", "PvP", "Construcción", "Técnico"];

      if (chartInstance) chartInstance.destroy();

      const ctx = document.getElementById("statsChart");
      chartInstance = new Chart(ctx, {
        type: "radar",
        data: {
          labels,
          datasets: [{
            label: "Estadísticas",
            data: stats,
            backgroundColor: "rgba(121, 51, 171, 0.4)",
            borderColor: "#b200ff",
            borderWidth: 2,
            pointBackgroundColor: "#fff"
          }]
        },
        options: {
          scales: {
            r: {
              angleLines: { color: "#444" },
              grid: { color: "#555" },
              pointLabels: { color: "#ccc", font: { size: 13 } },
              ticks: { color: "#999", stepSize: 1, beginAtZero: true, max: 10 }
            }
          },
          plugins: { legend: { display: false } }
        }
      });

      statsValues.innerHTML = `
        <p><b>Potencial:</b> ${stats[0]}</p>
        <p><b>Precisión:</b> ${stats[1]}</p>
        <p><b>Adaptabilidad:</b> ${stats[2]}</p>
        <p><b>PvP:</b> ${stats[3]}</p>
        <p><b>Construcción:</b> ${stats[4]}</p>
        <p><b>Técnico:</b> ${stats[5]}</p>
      `;

      modal.style.display = "flex";
    }

    document.querySelector(".close").onclick = () => {
      document.getElementById("modal").style.display = "none";
    };

    window.onclick = e => {
      if (e.target === document.getElementById("modal"))
        document.getElementById("modal").style.display = "none";
    };

    window.onload = cargarJugadores;
  </script>
</body>
</html>

