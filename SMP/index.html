<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ranking Shadows SMP</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <div class="header-logos">
      <img src="logo.png" alt="Shadows SMP" class="logo">
      <img src="ranking.png" alt="Ranking" class="ranking">
    </div>
  </header>

  <main>
    <section>
      <table id="rankingTable">
        <thead>
          <tr>
            <th>Skin</th>
            <th>Jugador</th>
            <th>Construcción</th>
            <th>Técnico</th>
            <th>PvP</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          <!-- Aquí se insertarán los jugadores automáticamente -->
        </tbody>
      </table>
    </section>
  </main>

  <footer>
    <p>© 2025 Shadows SMP</p>
  </footer>

<script>
  async function cargarJugadores() {
    const response = await fetch("jugadores.json");
    const jugadores = await response.json();

    const tbody = document.querySelector("#rankingTable tbody");
    tbody.innerHTML = "";

    for (const j of jugadores) {
      const fila = document.createElement("tr");

      const skinUrl = await obtenerSkinURL(j.nombre);
      fila.innerHTML = `
        <td><img src="${skinUrl}" alt="${j.nombre}" class="skin"></td>
        <td>${j.nombre}</td>
        <td>${j.construccion}</td>
        <td>${j.tecnico}</td>
        <td>${j.pvp}</td>
        <td>${j.total}</td>
      `;
      tbody.appendChild(fila);
    }

    ordenarTabla();
  }

  async function obtenerSkinURL(nombre) {
    try {
      // 1️⃣ Consulta al API oficial de Mojang para ver si el jugador existe
      const res = await fetch(`https://api.mojang.com/users/profiles/minecraft/${nombre}`);
      if (!res.ok) throw new Error("No premium");
      const data = await res.json();

      // 2️⃣ Si existe, usa su skin desde mc-heads (con overlay activado)
      return `https://mc-heads.net/avatar/${data.name}.png?overlay`;
    } catch {
      // 3️⃣ Si no existe (no premium), usa tu imagen local de Steve
      return "steve.png";
    }
  }

  function ordenarTabla() {
    const table = document.getElementById("rankingTable").tBodies[0];
    const rows = Array.from(table.rows);

    rows.sort((a, b) => {
      const pointsA = parseInt(a.cells[5].innerText, 10);
      const pointsB = parseInt(b.cells[5].innerText, 10);
      return pointsB - pointsA;
    });

    rows.forEach(row => table.appendChild(row));
  }

  window.onload = cargarJugadores;
</script>
</body>
</html>

